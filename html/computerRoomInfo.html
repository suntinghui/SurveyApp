<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/parse.css" />
		<link rel="stylesheet" href="../css/survey.css" />
		<link href="../css/mui.picker.css" rel="stylesheet" />
		<link href="../css/mui.poppicker.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/mui.dtpicker.css" />
	</head>

	<body>
		<header id="header" class="mui-bar mui-bar-nav navbar">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left backbtn"></a>
			<h1 id="title" class="mui-title">机房信息</h1>
			<a id='uploadImage' class="mui-btn mui-btn-link mui-pull-right">照片</a>
		</header>

		<div class="mui-content">
			<div class="mui-card mui-table-view">
				<input id='id' type="hidden" value='' class='param'></input>
				<input id='engroom_code' type="hidden" value='' class='param'></input>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">机房名称</div>
					<div class="item-value mui-input-row">
						<input id="name" type="text" class="param" disabled="disabled">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">所属地理空间</div>
					<div class="item-value mui-input-row">
						<input id="geos_id" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">所属客户</div>
					<div class="item-value mui-input-row">
						<input id="customer_id" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">机房大楼</div>
					<div class="item-value">
						<button id="big_typeSel" class="mui-btn mui-btn-block mybtn2">请选择</button>
					</div>
				</div>
				<input id='big_type' type="hidden" value='' class='param'></input>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">类型</div>
					<div class="item-value mui-input-row">
						<input id="type" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">总行数</div>
					<div class="item-value mui-input-row">
						<input id="rows" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">总列数</div>
					<div class="item-value mui-input-row">
						<input id="cols" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">冷通道总数</div>
					<div class="item-value mui-input-row">
						<input id="cools" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">热通道总数</div>
					<div class="item-value mui-input-row">
						<input id="hots" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">机房房间号</div>
					<div class="item-value mui-input-row">
						<input id="room_code" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">长度</div>
					<div class="item-value mui-input-row">
						<input id="length" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">宽度</div>
					<div class="item-value mui-input-row">
						<input id="width" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">高度</div>
					<div class="item-value mui-input-row">
						<input id="height" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">面积</div>
					<div class="item-value mui-input-row">
						<input id="area" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">架空地板尺寸</div>
					<div class="item-value mui-input-row">
						<input id="floorheight" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">机列布放</div>
					<div class="item-value mui-input-row">
						<input id="rackPlot" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">启用日期</div>
					<div class="item-value">
						<button id="start_timeSel" class="mui-btn mui-btn-block mybtn2">请选择日期</button>
					</div>
				</div>
				<input id='start_time' type="hidden" value='' class='param'></input>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">外墙朝向</div>
					<div class="item-value mui-input-row">
						<input id="exterior_walls_orientations" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">外墙数量</div>
					<div class="item-value mui-input-row">
						<input id="exterior_walls_count" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">经度</div>
					<div class="item-value mui-input-row">
						<input id="longitude" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">纬度</div>
					<div class="item-value mui-input-row">
						<input id="latitude" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="mui-table-view-cell">
					<p id="getLocation" style="float: left; color: dodgerblue;">手机定位</p>
					<p id="showLocation" style="float: right; color: dodgerblue;">核验输入的位置</p>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">所属区划</div>
					<div class="item-value">
						<button id="prov_idSel" class="mui-btn mui-btn-block mybtn2">请选择</button>
					</div>
				</div>
				<input id='prov_id' type="hidden" value='' class='param'></input>

				<div class="item-div">
					<div class="item-name">建筑结构</div>
					<div class="item-value">
						<button id="building_structureSel" class="mui-btn mui-btn-block mybtn2">请选择</button>
					</div>
				</div>
				<input id='building_structure' type="hidden" value='' class='param'></input>

				<div class="item-div">
					<div class="item-name">走线架方式</div>
					<div class="item-value">
						<button id="chamferSel" class="mui-btn mui-btn-block mybtn2">请选择</button>
					</div>
				</div>
				<input id='chamfer' type="hidden" value='' class='param'></input>

				<div class="item-div">
					<div class="item-name">地板类型</div>
					<div class="item-value">
						<button id="floor_typeSel" class="mui-btn mui-btn-block mybtn2">请选择</button>
					</div>
				</div>
				<input id='floor_type' type="hidden" value='' class='param'></input>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">地板规格</div>
					<div class="item-value mui-input-row">
						<input id="floor_format" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">静压箱高度</div>
					<div class="item-value mui-input-row">
						<input id="plenum_height" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

			</div>

			<div style="margin: 20px 10px;">
				<button id='confirmBtn' class="mui-btn mui-btn-block mui-btn-primary mybtn">确&nbsp;&nbsp;定</button>
			</div>

		</div>

		<script src="../js/mui.min.js"></script>
		<script type="text/javascript" src="../js/view.js"></script>
		<script src="../js/mui.picker.js"></script>
		<script src="../js/mui.poppicker.js"></script>
		<script type="text/javascript" src="../js/mui.dtpicker.js"></script>
		<script type="text/javascript" src="../js/city.data-3.js"></script>
		<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=x1C7K385dRjOuugisRHZuAkyoU9Cnm06"></script>
		<script type="text/javascript" src="../js/survey.js"></script>
		<script type="text/javascript" src="../js/util.js"></script>
		<script type="text/javascript" src="../js/constants.js"></script>

		<script type="text/javascript">
			mui.init();

			window.onload = function() {
				requestDetail();
			}

			function requestDetail() {
				checkNetwork();

				mui.plusReady(function() {
					plus.nativeUI.showWaiting("正在请求数据...");
					var info = {
						userName: window.localStorage.getItem(SaveUserName),
						engineroomId: window.localStorage.getItem(RoomId)
					};
					var url = getHost() + "/engineroomInterController/queryEngineroomInfo.json";
					console.log(url);
					mui.ajax(url, {
						dataType: 'json',
						data: JSON.stringify(info),
						type: 'post',
						timeout: TIMEOUT,
						headers: {
							'Content-Type': 'application/json'
						},
						success: function(data) {
							plus.nativeUI.closeWaiting();
							responseDetail(data);
						},
						error: function(xhr, type, errorThrown) {
							plus.nativeUI.closeWaiting();
							mui.toast(getHttpErrorDesp(type));
						}
					});
				});
			}

			function responseDetail(resp) {
				if(resp.respCode != '00') {
					mui.alert(resp.respMsg, "提示", null);
					return;
				}

				setValue(resp);
			}

			function requestUpdateDetail() {
				checkNetwork();

				mui.plusReady(function() {
					plus.nativeUI.showWaiting("正在提交数据...");

					var map = getValue();
					map['userName'] = window.localStorage.getItem(SaveUserName);
					map['engineroomId'] = window.localStorage.getItem(RoomId);

					console.log(JSON.stringify(map));

					var url = getHost() + "/engineroomInterController/updateEngineroomInfo.json";
					console.log(url);
					mui.ajax(url, {
						dataType: 'json',
						data: JSON.stringify(map),
						type: 'post',
						timeout: TIMEOUT,
						headers: {
							'Content-Type': 'application/json'
						},
						success: function(data) {
							plus.nativeUI.closeWaiting();
							responseUpdateDetail(data);
						},
						error: function(xhr, type, errorThrown) {
							plus.nativeUI.closeWaiting();
							mui.toast(getHttpErrorDesp(type));
						}
					});
				});
			}

			function responseUpdateDetail(resp) {
				if(resp.respCode != '00') {
					mui.alert(resp.respMsg, "提示", null);
					return;
				}

				mui.alert('保存成功', '提示', function() {
					//mui.back();
				});
			}

			// 查询客户信息
			function requestCustomerInfo() {
				checkNetwork();

				mui.plusReady(function() {
					var map = new Object();
					map['userName'] = window.localStorage.getItem(SaveUserName);
					map['engineroomId'] = window.localStorage.getItem(RoomId);

					var url = getHost() + "/customerInterController/queryCustomerList.json";
					mui.ajax(url, {
						dataType: 'json',
						data: JSON.stringify(map),
						type: 'post',
						timeout: TIMEOUT,
						headers: {
							'Content-Type': 'application/json'
						},
						success: function(data) {
							plus.nativeUI.closeWaiting();

							responseCustomerInfo(data);
						},
						error: function(xhr, type, errorThrown) {
							plus.nativeUI.closeWaiting();

							mui.toast(getHttpErrorDesp(type));
						}
					});
				});
			}

			function responseCustomerInfo(resp) {
				console.log(JSON.stringify(resp));

				if(resp.respCode != '00') {}
			}

			// 查询机楼信息
			function requestBuildList() {
				checkNetwork();

				mui.plusReady(function() {
					var map = new Object();
					map['userName'] = window.localStorage.getItem(SaveUserName);
					map['engineroomId'] = window.localStorage.getItem(RoomId);

					var url = getHost() + "/geospatialInterController/geospatialList.json";
					mui.ajax(url, {
						dataType: 'json',
						data: JSON.stringify(map),
						type: 'post',
						timeout: TIMEOUT,
						headers: {
							'Content-Type': 'application/json'
						},
						success: function(data) {
							plus.nativeUI.closeWaiting();

							responseBuildList(data);
						},
						error: function(xhr, type, errorThrown) {
							plus.nativeUI.closeWaiting();

							mui.toast(getHttpErrorDesp(type));
						}
					});
				});
			}

			function responseBuildList(resp) {
				var data = new Array();
				for(var i = 0; i < resp.buildList.length; i++) {
					var item = resp.buildList[i];
					data.push({
						value: item.	id,
						text: item.mac_build_name
					});
				}

				var userPicker = new mui.PopPicker();
				userPicker.setData(data);
				userPicker.show(function(selectItems) {
					document.getElementById('big_typeSel').innerHTML = selectItems[0].text;
					document.getElementById('big_type').innerHTML = selectItems[0].value;
				});
			}
		</script>

		<script>
			document.getElementById('getLocation').addEventListener('tap', function() {
				mui.toast('正在进行定位，请稍候...')
				var geolocation = new BMap.Geolocation();
				geolocation.getCurrentPosition(function(r) {
					if(this.getStatus() == BMAP_STATUS_SUCCESS) {
						var mk = new BMap.Marker(r.point);
						document.getElementById('longitude').value = r.point.lng;
						document.getElementById('latitude').value = r.point.lat;

					} else {
						mui.toast('手机定位失败:' + this.getStatus());
					}
				}, {
					enableHighAccuracy: true
				})
			}, false);

			document.getElementById('showLocation').addEventListener('tap', function() {
				var longitude = document.getElementById('longitude').value;
				var latitude = document.getElementById('latitude').value;

				mui.openWindow({
					url: 'showLocation.html',
					id: Math.random() + '',
					preload: true,
					show: {
						aniShow: 'pop-in'
					},
					extras: {
						longitude: longitude,
						latitude: latitude
					}
				});
			}, false);

			document.getElementById('confirmBtn').addEventListener('tap', function() {
				mui.confirm('请仔细核实信息是否正确？', '确认提交', ['取消', '提交'], function(e) {
					if(e.index == 1) {
						requestUpdateDetail();
					}
				})
			}, false);

			document.getElementById('uploadImage').addEventListener('tap', function() {
				var imageList = new Array(['机房全景图']);

				mui.openWindow({
					url: 'uploadImage.html',
					id: Math.random() + '',
					preload: true,
					show: {
						aniShow: 'pop-in'
					},
					extras: {
						imageList: imageList
					}
				});
			}, false);
		</script>

		<script>
			var cityPicker3 = new mui.PopPicker({
				layer: 3
			});
			cityPicker3.setData(cityData3);

			var showCityPickerButton = document.getElementById('prov_idSel');
			showCityPickerButton.addEventListener('tap', function(event) {
				cityPicker3.show(function(items) {
					showCityPickerButton.innerText = _getParam(items[0], 'text') + " " + _getParam(items[1], 'text') + " " + _getParam(items[2], 'text');
					document.getElementById('prov_id').innerHTML = items[2]['value'];
				});
			}, false);

			var _getParam = function(obj, param) {
				return obj[param] || '';
			};
		</script>

		<script>
			document.getElementById('big_typeSel').addEventListener('tap', function() {
				requestBuildList();
			}, false);
		</script>

		<script>
			var userPicker1 = new mui.PopPicker();
			userPicker1.setData([{
				value: '1',
				text: '钢筋混凝土'
			}, {
				value: '2',
				text: '框架结构'
			}, {
				value: '3',
				text: '其他'
			}]);
			var building_structureSel = document.getElementById('building_structureSel');
			building_structureSel.addEventListener('tap', function(event) {
				userPicker1.show(function(items) {
					building_structureSel.innerHTML = items[0].text;
					document.getElementById('building_structure').innerHTML = items[0].value;
				});
			}, false);
		</script>

		<script>
			var userPicker2 = new mui.PopPicker();
			userPicker2.setData([{
				value: '1',
				text: '上走线架'
			}, {
				value: '2',
				text: '下走线架'
			}, {
				value: '3',
				text: '双走线架'
			}, {
				value: '4',
				text: '地板下走线'
			}, {
				value: '5',
				text: '其他'
			}]);
			var chamferSel = document.getElementById('chamferSel');
			chamferSel.addEventListener('tap', function(event) {
				userPicker2.show(function(items) {
					chamferSel.innerHTML = items[0].text;
					document.getElementById('chamfer').innerHTML = items[0].value;
				});
			}, false);
		</script>

		<script>
			var userPicker3 = new mui.PopPicker();
			userPicker3.setData([{
				value: '1',
				text: '地砖'
			}, {
				value: '2',
				text: '架空地板'
			}, {
				value: '3',
				text: '其他'
			}]);
			var floor_typeSel = document.getElementById('floor_typeSel');
			floor_typeSel.addEventListener('tap', function(event) {
				userPicker3.show(function(items) {
					floor_typeSel.innerHTML = items[0].text;
					document.getElementById('floor_type').innerHTML = items[0].value;
				});
			}, false);
		</script>

		<script>
			var start_timeSel = document.getElementById('start_timeSel');
			start_timeSel.addEventListener('tap', function() {
				var picker = new mui.DtPicker(JSON.parse('{"type":"date","beginYear":1950,"endYear":2030}'));
				picker.show(function(selectItems) {
					start_timeSel.innerHTML = selectItems.text;
					document.getElementById('start_time').innerHTML = selectItems.value;
					picker.dispose();
				});
			}, false);
		</script>

	</body>

</html>