<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/parse.css" />
		<link rel="stylesheet" href="../css/survey.css" />
		<link href="../css/mui.picker.css" rel="stylesheet" />
		<link href="../css/mui.poppicker.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/mui.dtpicker.css" />
	</head>

	<body>
		<header id="header" class="mui-bar mui-bar-nav navbar">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left backbtn"></a>
			<h1 id="title" class="mui-title">添加制冷设备</h1>
		</header>

		<div class="mui-content">
			<div class="mui-card mui-table-view">

				<div class="item-div mui-table-view-cell">
					<div class="item-name">名称</div>
					<div class="item-value mui-input-row">
						<input id="name" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">编号</div>
					<div class="item-value mui-input-row">
						<input id="air_code" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">厂商</div>
					<div class="item-value mui-input-row">
						<input id="company" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">规格</div>
					<div class="item-value mui-input-row">
						<input id="format" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">品牌</div>
					<div class="item-value">
						<button id="brandSel" class="mui-btn mui-btn-block mybtn2">请选择</button>
					</div>
				</div>
				<input id="brand" type="hidden" class="param">

				<div class="item-div mui-table-view-cell">
					<div class="item-name">类型</div>
					<div class="item-value">
						<button id="typeSel" class="mui-btn mui-btn-block mybtn2">请选择</button>
					</div>
				</div>
				<input id="type" type="hidden" class="param">

				<div class="item-div mui-table-view-cell">
					<div class="item-name">额定功率</div>
					<div class="item-value mui-input-row">
						<input id="power" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">额定电压</div>
					<div class="item-value mui-input-row">
						<input id="voltage" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">制冷方式</div>
					<div class="item-value">
						<button id="modeSel" class="mui-btn mui-btn-block mybtn2">请选择</button>
					</div>
				</div>
				<input id='mode' type="hidden" value='' class='param'></input>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">设备布局</div>
					<div class="item-value">
						<button id="plotSel" class="mui-btn mui-btn-block mybtn2">请选择</button>
					</div>
				</div>
				<input id='plot' type="hidden" value='' class='param'></input>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">送风方式</div>
					<div class="item-value">
						<button id="supplyModeSel" class="mui-btn mui-btn-block mybtn2">请选择</button>
					</div>
				</div>
				<input id='supplyMode' type="hidden" value='' class='param'></input>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">额定制冷量</div>
					<div class="item-value mui-input-row">
						<input id="conditioner" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">能效比</div>
					<div class="item-value mui-input-row">
						<input id="cop" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">长度</div>
					<div class="item-value mui-input-row">
						<input id="length" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">宽度</div>
					<div class="item-value mui-input-row">
						<input id="width" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">高度</div>
					<div class="item-value mui-input-row">
						<input id="height" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">启用日期</div>
					<div class="item-value">
						<button id="start_timeSel" class="mui-btn mui-btn-block mybtn2">请选择日期</button>
					</div>
				</div>
				<input id='start_time' type="hidden" value='' class='param'></input>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">循环风量</div>
					<div class="item-value mui-input-row">
						<input id="loop_air_flow" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">压缩机型号</div>
					<div class="item-value mui-input-row">
						<input id="compressor_model" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">制冷剂</div>
					<div class="item-value mui-input-row">
						<input id="cryogen" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">空调设定温度</div>
					<div class="item-value mui-input-row">
						<input id="set_temp" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">送风风速</div>
					<div class="item-value mui-input-row">
						<input id="in_wind" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">送风口底部到地面距离</div>
					<div class="item-value mui-input-row">
						<input id="in_wind_fool_range" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">回风口底部到地面距离</div>
					<div class="item-value mui-input-row">
						<input id="out_wind_fool_range" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">精密空调送风口高度</div>
					<div class="item-value mui-input-row">
						<input id="in_wind_height" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">送风口尺寸</div>
					<div class="item-value mui-input-row">
						<input id="in_wind_size" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">回风口尺寸</div>
					<div class="item-value mui-input-row">
						<input id="out_wide_size" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">空调尺寸</div>
					<div class="item-value mui-input-row">
						<input id="size" type="text" class="mui-input-speech mui-input-clear param">
					</div>
				</div>

				<div class="item-div mui-table-view-cell">
					<div class="item-name">所属机架</div>
					<div class="item-value">
						<button id="rack_codeSel" class="mui-btn mui-btn-block mybtn2">请选择</button>
					</div>
				</div>
				<input id='rackCode' type="hidden" value='' class='param'></input>

			</div>

			<div style="margin: 20px 10px;">
				<button id='confirmBtn' class="mui-btn mui-btn-block mui-btn-primary mybtn">确&nbsp;&nbsp;定</button>
			</div>

		</div>

		<script src="../js/mui.min.js"></script>
		<script type="text/javascript" src="../js/view.js"></script>
		<script src="../js/mui.picker.js"></script>
		<script src="../js/mui.poppicker.js"></script>
		<script type="text/javascript" src="../js/city.data-3.js"></script>
		<script type="text/javascript" src="../js/mui.dtpicker.js"></script>
		<script type="text/javascript" src="../js/constants.js"></script>
		<script type="text/javascript" src="../js/util.js"></script>
		<script type="text/javascript" src="../js/view.js"></script>
		<script type="text/javascript" src="../js/survey.js"></script>

		<script type="text/javascript">
			mui.init();

			window.onload = function() {
				mui.plusReady(function() {
					pickerCtrlImp('type', 'typeSel', 'airconditioning_type', '0');
					pickerCtrlImp('brand', 'brandSel', 'brand', '0');
					pickerCtrlImp('mode', 'modeSel', 'mode', '0');
					pickerCtrlImp('plot', 'plotSel', 'plot', '0');
					pickerCtrlImp('supplyMode', 'supplyModeSel', 'supplyMode', '0');
					datePickerCtrlImp('start_time', 'start_timeSel', getyyyyMMdd(new Date()));
				})
			}

			document.getElementById('confirmBtn').addEventListener('tap', function() {
				mui.confirm('请仔细核实信息是否正确？', '确认添加', ['取消', '提交'], function(e) {
					if(e.index == 1) {
						requestAdd();
					}
				})
			}, false);

			function requestAdd() {
				checkNetwork();

				mui.plusReady(function() {
					plus.nativeUI.showWaiting("正在请求数据...");

					var info = getValue();
					info['userName'] = window.localStorage.getItem(SaveUserName);
					info['engineroom_id'] = window.localStorage.getItem(Engineroom_id);
					
					console.log(JSON.stringify(info));

					var url = getHost() + "/airConditioningInterController/addAirConditioning.json";
					mui.ajax(url, {
						dataType: 'json',
						data: JSON.stringify(info),
						type: 'post',
						timeout: TIMEOUT,
						headers: {
							'Content-Type': 'application/json'
						},
						success: function(data) {
							plus.nativeUI.closeWaiting();

							responseAdd(data);
						},
						error: function(xhr, type, errorThrown) {
							plus.nativeUI.closeWaiting();
							mui.toast(getHttpErrorDesp(type));
						}
					});
				});
			}

			function responseAdd(resp) {
				if(resp.respCode == '00') {
					mui.alert('添加成功', '提示', function() {
						mui.plusReady(function() {
							plus.webview.currentWebview().opener().reload();
							mui.back();
						})
					});

				} else {
					mui.alert(resp.respMsg, "提示", null);
				}
			}
		</script>

		<script>
			var rack_codeSel = document.getElementById('rack_codeSel');
			rack_codeSel.addEventListener('tap', function(event) {
				mui.openWindow({
					url: 'airconditioning_rack.html',
					id: Math.random() + '',
					preload: true,
					show: {
						aniShow: 'pop-in'
					},
					extras: {
						radioType: false,
						selected: [],
						firevent: 'refreshRack'
					}
				});

			}, false);

			window.addEventListener('refreshRack', function(event) {
				var data = event.detail.data;
				console.log(data.value);
				document.getElementById('rackCode').value = data.value;
			}, false);
		</script>

	</body>

</html>